services:
  sender:
    build: .
    environment:
      - MODE=sender
      - DEST_HOST=${DEST_HOST:-receiver}
      - DEST_MODULE=video-sync
      - SYNC_INCLUDE=*.mkv,*.mp4,*.avi
      - RSYNC_USER=${RSYNC_USER:-syncuser}
      - RSYNC_PASSWORD=${RSYNC_PASSWORD:-secretpassword}
      - BWLIMIT_MBPS=${BWLIMIT_MBPS:-50}
      - MIN_DISK_SPACE_GB=${MIN_DISK_SPACE_GB:-0}
      - DISCORD_WEBHOOK_URL=${DISCORD_WEBHOOK_URL:-}
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN:-}
      - TELEGRAM_CHAT_ID=${TELEGRAM_CHAT_ID:-}
      - POLL_INTERVAL=${POLL_INTERVAL:-60}
      - AUTH_ENABLED=${AUTH_ENABLED:-true}
      - ADMIN_USER=${ADMIN_USER:-admin}
      - ADMIN_PASS=${ADMIN_PASS:-schnorarr}
      - SYNC_1_SOURCE=/data/movies
      - SYNC_1_TARGET=movies
      - SYNC_1_RULE=flat
      - SYNC_2_SOURCE=/data/tv
      - SYNC_2_TARGET=tv
      - SYNC_3_SOURCE=/data/music
      - SYNC_3_TARGET=music
      - SYNC_4_SOURCE=/data/books
      - SYNC_4_TARGET=books
      - SYNC_5_SOURCE=/data/photos
      - SYNC_5_TARGET=photos
      # - TAILSCALE_AUTHKEY=tskey-auth-xxxx
      # - TS_HOSTNAME=schnorarr-sender
      # - TAILSCALE_UP_ARGS=--accept-routes
    ports:
      - "8080:8080"
    volumes:
      - ./sender:/data
      - sender_config:/config
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    restart: unless-stopped

volumes:
  sender_config:
